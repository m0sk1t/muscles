angular.module("MuscleMan",["ngLocale","ngFileUpload","ngRoute","720kb.datepicker","Services"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"tpl/main.tpl",controller:"MainCtrl"}).when("/auth",{templateUrl:"tpl/auth.tpl",controller:"AuthCtrl"}).when("/album/:id",{templateUrl:"tpl/album.tpl",controller:"AlbumCtrl"}).when("/articles",{templateUrl:"tpl/articles.tpl",controller:"ArticlesCtrl"}).when("/article/:id",{templateUrl:"tpl/article.tpl",controller:"ArticleCtrl"}).when("/competitions",{templateUrl:"tpl/competitions.tpl",controller:"CompetitionsCtrl"}).when("/competition/:id",{templateUrl:"tpl/competition.tpl",controller:"CompetitionCtrl"}).when("/contests",{templateUrl:"tpl/contests.tpl",controller:"ContestsCtrl"}).when("/contest/:id",{templateUrl:"tpl/contest.tpl",controller:"ContestCtrl"}).when("/dialogs",{templateUrl:"tpl/dialogs.tpl",controller:"DialogsCtrl"}).when("/favs",{templateUrl:"tpl/favs.tpl",controller:"FavsCtrl"}).when("/photos",{templateUrl:"tpl/photos.tpl",controller:"PhotosCtrl"}).when("/options",{templateUrl:"tpl/options.tpl",controller:"OptionsCtrl"}).when("/search",{templateUrl:"tpl/search.tpl",controller:"SearchCtrl"}).when("/status",{templateUrl:"tpl/status.tpl",controller:"StatusCtrl"}).when("/user",{templateUrl:"tpl/user.tpl",controller:"UserCtrl"}).otherwise({redirectTo:"/auth"})}]),angular.module("Services",[]).factory("User",["$http",function(t){return{get:function(o,e){return t.get("/user").then(o,e)},set:function(o,e,n){return t.put("/user",o).then(e,n)},auth:function(o,e,n){return t.post("/auth",o).then(e,n)}}}]).factory("Photo",["$http",function(t){return{get:function(o,e,n){return t.get("/photo/"+o||"all").then(e,n)},edit:function(o,e,n){return t.put("/photo/"+o._id,o).then(e,n)},"delete":function(o,e,n){return t["delete"]("/photo/"+o).then(e,n)},add_like:function(o,e,n){return t.put("/photo/"+o._id+"/add_like",o).then(e,n)},remove_like:function(o,e,n){return t.put("/photo/"+o._id+"/remove_like",o).then(e,n)},add_comment:function(o,e,n){return t.put("/photo/"+o._id+"/add_comment",o).then(e,n)},remove_comment:function(o,e,n){return t.put("/photo/"+o._id+"/remove_comment",o).then(e,n)}}}]).factory("Album",["$http",function(t){return{get:function(o,e,n){return t.get("/album/"+o||"all").then(e,n)},create:function(o,e,n){return t.post("/album/new",{title:o}).then(e,n)},set_title:function(o,e,n){return t.put("/album/"+o._id,o).then(e,n)},add_photo:function(o,e,n){return t.put("/album/"+o._id+"/add_photo/"+o.photoid,o).then(e,n)},remove_photo:function(o,e,n){return t.put("/album/"+o._id+"/remove_photo/"+o.photoid,o).then(e,n)},"delete":function(o,e,n){return t["delete"]("/album/"+o).then(e,n)}}}]).factory("MSG",function(){return{ok:function(t){swal("OK!",t)},info:function(t){swal("Info!",t,"info")},warn:function(t){swal("Warning!",t,"warning")},err:function(t){swal("Error!",t,"error")},custom:function(t,o){swal(t,o)}}}).factory("LS",function(){return{get:function(t){try{var t=localStorage.getItem(t);return t?JSON.parse(t):null}catch(o){return console.error(o),null}},set:function(t,o){try{var e=o?JSON.stringify(o):"";return localStorage.setItem(t,e),!0}catch(n){return localStorage.clear(),console.error(n),!1}}}}).factory("socket",["$rootScope",function(t){var o=io();return{on:function(e,n){o.on(e,function(){var e=arguments;t.$apply(function(){n.apply(o,e)})})},emit:function(e,n,l){o.emit(e,n,function(){var e=arguments;t.$apply(function(){l&&l.apply(o,e)})})}}}]),angular.module("MuscleMan").controller("AlbumCtrl",["$scope","$routeParams","Photo","Album",function(t,o,e,n){t.album={},t.photos=[],t.gallery={current:0},t.turnLeft=function(){0==t.gallery.current?t.gallery.current=t.photos.length:t.gallery.current--},t.turnRight=function(){t.gallery.current==t.photos.length-1?t.gallery.current=0:t.gallery.current++},e.get("all",function(e){t.photos=e.data.filter(function(t){return t.album===o.id})},function(t){console.error(t.data)}),n.get(o.id,function(o){t.album=o.data},function(t){console.error(t.data)})}]),angular.module("MuscleMan").controller("ArticleCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("ArticlesCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("AuthCtrl",["$scope","$location","User","LS",function(t,o,e,n){t.cred={mail:"",pass:""},t.auth=function(){t.cred.mail.$error||e.auth(t.cred,function(e){switch(t.options.loading=!1,e.status){case 202:t.options.user=e.data,n.set("user",e.data),o.path("/user");break;default:o.path("/options")}},function(t){})}}]),angular.module("MuscleMan").controller("CompetitionCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("CompetitionsCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("ContestCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("ContestsCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("DialogsCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("FavsCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("MainCtrl",["$scope","socket","User","LS",function(t,o,e,n){o.on("user:online",function(t){console.log("user:online"),console.log(t)}),o.on("message:send",function(t){console.log("message:send"),console.log(t)}),t.message_send=function(t){o.emit("message:send",t)},t.options={user:n.get("user")||0},t.getloc=function(){return"#/"===location.hash},!!t.options.user&&e.get(function(o){t.options.user=o.data,n.set("user",o.data)},function(t){location.hash="#/auth"}),t.$on("user_save",function(){e.set(t.options.user,function(o){n.set("user",t.options.user),console.log("User saved!")},function(t){console.error(t.data)})})}]),angular.module("MuscleMan").controller("OptionsCtrl",["$scope",function(t){t.cred={old_password:"",new_password:""},t.active_page="profile",t.user_save=function(){t.$emit("user_save")}}]),angular.module("MuscleMan").controller("PhotosCtrl",["$scope","Upload","Photo","Album","MSG",function(t,o,e,n,l){t.photos=[],t.albums=[],t.layer={editedAlbum:null,editedPhoto:null},n.get("all",function(o){t.albums=o.data},function(t){console.error(t.data)}),e.get("all",function(o){t.photos=o.data},function(t){console.error(t.data)}),t.createAlbum=function(){l.custom({type:"input",closeOnConfirm:!1,showCancelButton:!0,cancelButtonText:"Отмена",inputPlaceholder:"Название",text:"Введите название альбома",title:"Название"},function(o){o&&n.create(o,function(o){l.ok("Альбом создан!"),t.albums.push(o.data)},function(t){l.err(t.data),console.error(t.data)})})},t.edit_photo=function(o){e.edit(o,function(o){t.photos=t.photos.map(function(o){return o._id===t.layer.editedPhoto._id&&(o._id=t.layer.editedPhoto._id),o}),t.layer.editedPhoto=null,l.ok("Настройки фото успешно изменены!")},function(t){console.error(t.data)})},t.edit_album=function(o){n.set_title(o,function(o){t.albums=t.albums.map(function(o){return o._id===t.layer.editedAlbum._id&&(o._id=t.layer.editedAlbum._id),o}),t.layer.editedAlbum=null,l.ok("Нименование альбома успешно изменено!")},function(t){console.error(t.data)})},t.delete_album=function(o){n["delete"](o,function(e){t.albums=t.albums.filter(function(t){return t._id!==o})},function(t){console.error(t.data)})},t.delete_photo=function(o){e["delete"](o,function(e){t.photos=t.photos.filter(function(t){return t._id!==o})},function(t){console.error(t.data)})},t.uploadFiles=function(e){if(e&&e.length)for(var n=0;n<e.length;n++)o.upload({url:"/photo/new",data:{file:e[n]}}).then(function(o){t.photos.push(o.data)})}}]),angular.module("MuscleMan").controller("SearchCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("StatusCtrl",["$scope",function(t){t.options={}}]),angular.module("MuscleMan").controller("UserCtrl",["$scope",function(t){t.getAge=function(t){var o=moment(),t=moment(t);return o.diff(t,"years")},t.user_save=function(){t.$emit("user_save")}}]);